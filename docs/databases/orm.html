<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-73924704-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-73924704-2', { 'anonymize_ip': true });
    </script>
    <title>Learn - Getting Started</title>
    <link rel="icon" type="image/png" href="../assets/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/favicon-16x16.png" sizes="16x16" />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../../css/reset.css">
    <link rel="stylesheet" href="../../css/docs.css">
    <link href=“https://fonts.googleapis.com/css?family=IBM+Plex+Sans” rel=“stylesheet”>
  </head>
  <body>
    <h1>Swift Kuery ORM</h1>
    <h2>Prerequisites</h2>
    <ul class="plain-list">
      <li><span class="blue-text">Kitura Server:</span> Learn how to create one in our getting started guide</li>
      <li><span class="blue-text">Routing:</span> Learn how to add routes in our routing guides</li>
      <li><span class="blue-text">Updated Package.swift:</span> Learn how to update the Package.swift in our guide</li>
    </ul>
    <div class="underline"></div>
    <h2><span class="blue-text">Step 1:</span> Add Swift Kuery ORM to the project</h2>
    <p>import Swift Kuery ORM to our project:</p>
    <pre>import SwiftKueryORM</pre>
    <p>To work with the ORM we need to have a Database plugin to use.</p>
    <p>In this example we will be using <a>SwiftKueryPostgreSQL</a>:</p>
    <pre>import SwiftKueryPostgreSQL</pre>
    <div class="info">
      <p>You can use any database plugin but ensure that it's been added to your Package.swift.</p>
    </div>
    <div class="underline"></div>
    <h2><span class="blue-text">Step 2:</span> Update our Model</h2>
    <p>The key component of Swift Kuery ORM is the Model protocol.</p>
    <p>All we need to do to make use of the Model protocol is create an extension for our Model:</p>
    <pre>extension User: Model { }</pre>
    <p>The Model protocol extends what Codable provides to work with the ORM.</p>
    <div class="underline"></div>
    <h2><span class="blue-text">Step 3:</span> Create a database connection</h2>
    <h3>Install the PostgreSQL client</h3>
    <p>To use Swift-Kuery-PostgreSQL you need to have the appropiate PostgreSQL C-language client installed.</p>
    <h4>macOS</h4>
    <p>On macOS we can use Homebrew to install Postgres:</p>
    <pre>brew install postgresql</pre>
    <h4>Linux</h4>
    <p>On Linux we can use `apt-get` to install Postgres:</p>
    <pre>sudo apt-get install libpq-dev</pre>
    <h3>Create a PostgreSQL database</h3>
    <p>Now that we have PostgreSQL installed we can create a database:</p>
    <pre>createdb userdb</pre>
    <p>Then we can open the PostgreSQL command-line interface:</p>
    <pre>psql userdb</pre>
    <p>Finally we can create a table in our database:</p>
    <pre>CREATE TABLE users (
    name varchar(100) NOT NULL CHECK (name &lt;&gt; ''),
    age integer NOT NULL,
    active BOOLEAN NOT NULL
);</pre>
    <p>All that's left is to add values to our database:</p>
    <pre>INSERT INTO users VALUES ('David', 27, true);
INSERT INTO users VALUES ('Sammi', 32, false);
INSERT INTO users VALUES ('Jane', 48, true);</pre>
    <p>Now we're ready to connect to our database from our Kitura server.</p>
    <h3>Create a PostgreSQLConnection:</h3>
    <pre>let connection = PostgreSQLConnection(host: "localhost", port: 5432, options: [.databaseName("userdb")])</pre>
    <div class="underline"></div>
    <h2><span class="blue-text">Step 4:</span> Save an Object to our database</h2>
    <p>If you'd like to save a new object to your database, you have to create the object and use the save() function:</p>
    <pre>
let grade = Grade(course: "physics", grade: 80)
grade.save { grade, error in
  ...
}   </pre>
    <p>You also optionally have the ability to pass the ID of the newly saved object into your closure. Add it to the collection of parameters like so:</p>
    <pre>
grade.save { (id: Int?, grade: Grade?, error: RequestError?) in
  ...
}   </pre>
    <div class="underline"></div>
    <h2>Step 5: Update an Object in your database</h2>
    <p>If you have the id for an existing record of your object, and you'd like to update the record with an object, you can use the update() function to do so:</p>
    <pre>
let grade = Grade(course: "physics", grade: 80)
grade.course = "maths"

grade.update(id: 1) { grade, error in
  ...
}   </pre>
    <div class="underline"></div>
    <h2>Step 6: Retrieve an Object from your database</h2>
    <p>If you'd like to find a specific object, and you have its id, you can use the find() function to retrieve it:</p>
    <pre>
Grade.find(id: 1) { result, error in
  ...
}   </pre>
    <p>If you'd like to retrieve all instances of a particular object, you can make use of findAll() as a static function on the type you are trying to retrieve:</p>
    <pre>
Grade.findAll { (result: [Grade]?, error: RequestError?) in
  ...
}   </pre>
    <p>You also have the ability to form your results in different ways and formats, like so:</p>
    <pre>
Grade.findAll { (result: [(Int, Grade)]?, error: RequestError?) in
  ...
}   </pre>
    <pre>
Grade.findAll { (result: [Int: Grade]?, error: RequestError?) in
  ...
}   </pre>
    <div class="underline"></div>
    <h2>Step 7: Delete an Object from your database</h2>
    <p>If you'd like to delete an object, and you have its id, you can use the delete() function like so:</p>
    <pre>
Grade.delete(id: 1) { error in
  ...
}   </pre>
    <p>If you're feeling bold, and you'd like to remove all instances of an object from your database, you can use the static function deleteAll() with your type:</p>
    <pre>
Grade.deleteAll { error in
  ...
}   </pre>
    <div class="underline"></div>
    <h2>Step 8: Customise your queries</h2>
    <p>The ORM uses Swift-Kuery which allows you to customize and execute your own queries without breaking any existing ORM functionality. You'll want to have access to the table for your object, which you can get with the getTable() function:</p>
    <pre>
do {
  let table = Grade.getTable()
} catch {
  // Error
}   </pre>
    <p>After you retrieve your table, you can create a Query object to specify what you want to execute on your database, and perform it like so:</p>
    <pre>
executeQuery(query: Query) { (grade: Grade?, error: RequestError?) in
  ...
}   </pre>
    <p>You can customize the parameters passed into your closure after you execute a Query like so:</p>
    <pre>
executeQuery(query: Query) { grade, error in
  ...
}

executeQuery(query: Query) { error in
  ...
}   </pre>
    <p>If you'd like to learn more about how you can customize queries, check out the Swift-Kuery repository for more information.</p>
    <div class="underline"></div>
    <h2>Next steps</h2>
    <p><span class="blue-text bold">Add logging:</span> Get useful feedback from your server about startup and errors</p>
    <p><span class="blue-text bold">Add routing:</span> Add REST APIs, such as HTTP GET, to your server</p>
  </body>
</html>
