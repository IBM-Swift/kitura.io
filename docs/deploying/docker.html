<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
			<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-73924704-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

		gtag('config', 'UA-73924704-2', { 'anonymize_ip': true });
</script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">
    <title>Dockerise your app</title>
    <link rel="icon" type="image/png" href="../../assets/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../../assets/favicon-16x16.png" sizes="16x16" />
    <link href=“https://fonts.googleapis.com/css?family=IBM+Plex+Sans” rel=“stylesheet”>
    <link rel="stylesheet" href="../../css/reset.css">
    <link rel="stylesheet" href="../../css/dist/docs.css">
  </head>
<body>
  <section class="docs-grid-container">
    <aside id="sidebar" class="docs-item-1 docs-sidebar">
      <h1 class="docs-title"><a href="/index.html">KITURA <span class="blue-text">DOCS</span></a></h1>
      <div class="underline-title"></div>
      <ul class="sidebar-list">
        <li class="sidebar-item collapsible">Getting Started</li>
        <ul class="nested-sidebar-list content">
          <li class="nested-sidebar-item"><a href="../getting-started/installation-mac.html">Install Swift for macOS</a></li>
          <li class="nested-sidebar-item"><a href="../getting-started/installation-linux.html">Install Swift for Linux</a></li>
          <li class="nested-sidebar-item"><a href="../getting-started/hello-world.html">Hello World</a></li>
          <li class="nested-sidebar-item"><a href="../getting-started/create-server.html">Create a server</a></li>

          <li class="nested-sidebar-item"><a href="../getting-started/update-package.html">Adding Packages</a></li>
        </ul>
        <li class="sidebar-item collapsible">Logging</li>
        <ul class="nested-sidebar-list content">
          <li class="nested-sidebar-item"><a href="../logging/logging.html">What is Logging?</a></li>
          <li class="nested-sidebar-item"><a href="../logging/helium-logger.html">Helium Logger</a></li>
        </ul>
        <li class="sidebar-item collapsible">Routing</li>
        <ul class="nested-sidebar-list content">
          <li class="nested-sidebar-item"><a href="../routing/routing.html">What is routing?</a></li>
          <li class="nested-sidebar-item"><a href="../routing/codable-routing.html">Codable routing</a></li>
          <li class="nested-sidebar-item"><a href="../routing/raw-routing.html">Raw routing</a></li>
          <li class="nested-sidebar-item"><a href="../routing/open-api.html">OpenAPI</a></li>
        </ul>
        <li class="sidebar-item collapsible">Databases</li>
        <ul class="nested-sidebar-list content">
          <li class="nested-sidebar-item"><a href="../databases/databases.html">What are Databases?</a></li>
          <li class="nested-sidebar-item"><a href="../databases/swift-kuery-orm.html">SQL: ORM</a></li>
          <li class="nested-sidebar-item"><a href="../databases/swift-kuery.html">SQL: Kuery</a></li>
          <li class="nested-sidebar-item"><a href="../databases/couchdb.html">NoSQL: CouchDB</a></li>
        </ul>
        <li class="sidebar-item collapsible">Sessions</li>
        <ul class="nested-sidebar-list content">
          <li class="nested-sidebar-item"><a href="../sessions/sessions.html">What are Sessions?</a></li>
          <li class="nested-sidebar-item"><a href="../sessions/kitura-session.html">Raw Routing Session</a></li>
          <li class="nested-sidebar-item"><a href="../sessions/type-safe-session.html">Codable Routing Session</a></li>
        </ul>
        <li class="sidebar-item collapsible">Authentication</li>
        <ul class="nested-sidebar-list content">
          <li class="nested-sidebar-item"><a href="../authentication/authentication.html">What is Authentication?</a></li>
          <li class="nested-sidebar-item"><a href="../authentication/typesafe-auth.html">Basic Authentication</a></li>
          <li class="nested-sidebar-item"><a href="../authentication/jwt-auth.html">JSON Web Tokens</a></li>
          <li class="nested-sidebar-item"><a href="../authentication/fb-google-oauth2.html">OAuth 2.0 with Facebook/Google</a></li>
        </ul>
        <li class="sidebar-item collapsible">Web Application</li>
        <ul class="nested-sidebar-list content">
          <li class="nested-sidebar-item"><a href="../templating/templating.html">What are Web Applications?</a></li>
          <li class="nested-sidebar-item"><a href="../templating/static-file-server.html">Static File Server</a></li>
          <li class="nested-sidebar-item"><a href="../templating/stencil.html">Stencil</a></li>
          <li class="nested-sidebar-item"><a href="../templating/markdown.html">Markdown</a></li>
        </ul>
        <li class="sidebar-item collapsible">Deploying</li>
        <ul class="nested-sidebar-list content" style="max-height: 400px;">
          <li class="nested-sidebar-item"><a href="../deploying/monitoring.html">Monitoring</a></li>
          <li class="nested-sidebar-item"><a href="../deploying/ssl.html">Enabling SSL/TLS</a></li>
          <li class="nested-sidebar-item active"><a href="../deploying/docker.html">Docker</a></li>
          <li class="nested-sidebar-item"><a href="../deploying/kubernetes.html">Kubernetes</a></li>
          <li class="nested-sidebar-item"><a href="../deploying/cloud-foundry.html">Cloud Foundry</a></li>
        </ul>
      </ul>
    </aside>
    <div id="burgerIcon" class="burger-icon" onclick="showSidebar()">
      <div class="burger-line"></div>
      <div class="burger-line"></div>
      <div class="burger-line"></div>
    </div>
    <div class="docs-item-2 search-container">
      <!-- <input class="docs-search" type="text" name="searchInput" placeholder="Search documentation..."> -->
      <div id="beta" class="temp-beta">
        <h4>Currently in Beta - <a href="../../old-learn.html">View old docs</a></h4>
      </div>
    </div>
    <nav class="docs-item-3 docs-nav">
      <button id="api-button" class="apiref-button" type="button" name="button" onclick="window.open('https://ibm-swift.github.io/Kitura/')">API Reference</button>
      <a class="nav-item" target="_blank" href="http://slack.kitura.io/">Need help?</a>
      <a class="nav-item" target="_blank" href="https://github.com/IBM-Swift/kitura.io/issues">Found an issue?</a>
    </nav>
    <div id="doc-container" class="docs-item-4 docs-window">
      <main>
        <h1 class="heading-1">Deploy to the Docker platform</h1>
        <h2 class="heading-2"> Introduction.</h2>
        <p> Docker is a platform that facilitates the management the life cycle of lightweight virtualization technologies know as containers.
        While a complete description of the docker platform is beyond the scope of this guide, we will cover the steps
        necessary to Dockerize your Kitura appliucation, including the building of docker images containing your application and then we will create
        container instances of your application image.

        A full description of the Docker platform can be found on the Docker <a href="https://docs.docker.com/get-started/" >website </a>, including the installation instructions for the
        supported operating systems. This guide will be based on the two Dockerfiles generated by the <a href="http://localhost:3000/docs/getting-started/create-server-cli.html">Kitura init </a>command. </p>

        <h2 class="heading-2"><span class="blue-text">Step 1:</span> Build compile image</h2>
        <p> As the Swift compiler is rather large and unecessary for compiled Kitura applications the first step is to separate the application compilation and the application runtime into two docker images, a build image and a run image. The Kitura init command supports this two step build process by generating two Dockerfiles for your Kitura project, Dockerfile-tools supports the compilation step and the Dockerfile supports the building of the Docker image of your Kitura application.</p>
        <p>We first need to build the compile image:</p>
        <pre><code class="language-swift">docker build -t myapp-build -f Dockerfile-tools .</code></pre>
        <p> The above command builds a docker image called "myapp-build" using the Kitura generated Dockerfile-tools file which can be used to compile our Kitura application. On inspection of the Dockerfile-tools file we can see that the command derives an new swift compilier image from a Docker image published by the Kitura development team.
        <div class="underline"></div>
        <h2 class="heading-2"><span class="blue-text">Step 2:</span> Compile application code</h2>
        <p>Using the image we've just built we can compile the application code with the following command.</p>
        <pre><code class="language-swift">docker run -v $PWD:/swift-project -w /swift-project myapp-build /swift-utils/tools-utils.sh build release</code></pre>
           The docker run command takes the '-v' option which maps the current working directory on the host to the '/swift-project' directory on the Docker container.
           The -w option sets the working directory of the container to the host mapped drive /swift-utils.
           We then tell docker run to create a container using the tag name of the image we wish to use.
           Finally we invoke the utility script that is located in the container at /swift-utils/tools-utils.sh passing two paramters to this script namely build and release
           The tools-utils.sh file can be viewed <a href="https://github.com/IBM-Swift/Kitura-Sample/blob/master/Dockerfile-tools">here. </a>
        <div class="underline"></div>
        <h2 class="heading-2"><span class="blue-text">Step 3:</span> Build the run image</h2>
        <p> Now that we have compiled our Kitura application we can now build the Docker runtime image, with the following command.</p>

        <pre><code class="language-swift">docker build -t myapp-run .</code></pre>
        <div class="underline"></div>
            This command builds a Docker image which is tagged "myapp-run" using the Kitura generated Dockerfile which derives a new image from the ibmcom/swift-ubuntu-runtime:5.0.1.
            The newly built Docker image contains your compiled Kitura application and the necessary Swift runtime libraries.

            <h2 class="heading-2"><span class="blue-text">Step 4:</span> Check the image is available</h2>
            <p> Docker allows you to list your local images with the following command </p>
            <pre><code class="language-swift">docker image ls</code></pre>
            <p>This command will list the Docker images available in your local repository which will include your recently built image tagged "myapp-run".</p>

        <h2 class="heading-2"><span class="blue-text">Step 5:</span> Start the Docker container</h2>
        <p> Now that we have an image that contains our kitura application, we just need to run an instance of the image</p>
        <pre><code class="language-swift">docker run -p 8080:8080 -it myapp-run</code></pre>
        <p> The above docker run command initially the -p publishes all exposed ports to the host interfaces. and then runs a container from the myapp-run image in interactive mode.
          For a full description of the <a href="https://docs.docker.com/engine/reference/run/"> docker run </a> command. A docker container will automatically end once your application has exited so assuming that your application is still running
          you can see your container is running with the following command</p>

          <pre><code class="language-swift"> docker container ps -a</pre>
      </main>
    </div>
    <div id="top-page" class="top-page">
      <a href="#">Back to top</a>
    </div>
  </section>
  <script type="text/javascript" src="../../scripts/learn.js"></script>
</body>
</html>
