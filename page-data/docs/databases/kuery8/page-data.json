{"componentChunkName":"component---src-templates-docs-js","path":"/docs/databases/kuery8","result":{"data":{"docs":{"html":"<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">import</span> <span class=\"token builtin\">LoggerAPI</span>\n  <span class=\"token keyword\">import</span> <span class=\"token builtin\">Foundation</span>\n  <span class=\"token keyword\">import</span> <span class=\"token builtin\">SwiftKuery</span>\n  <span class=\"token keyword\">import</span> <span class=\"token builtin\">SwiftKueryPostgreSQL</span> <span class=\"token comment\">// This will be different if you did not use PostgreSQL</span>\n\n  <span class=\"token keyword\">func</span> <span class=\"token function\">initializeKueryRoutes</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">:</span> <span class=\"token builtin\">App</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n      app<span class=\"token punctuation\">.</span>router<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/kuery\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">,</span> next <span class=\"token keyword\">in</span>\n          <span class=\"token keyword\">guard</span> <span class=\"token keyword\">let</span> book <span class=\"token operator\">=</span> <span class=\"token keyword\">try</span><span class=\"token operator\">?</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">as</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">Book</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword\">let</span> <span class=\"token number\">_</span> <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>badRequest<span class=\"token punctuation\">)</span>\n              <span class=\"token keyword\">return</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span>\n          <span class=\"token keyword\">let</span> rows <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>book<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> book<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">,</span> book<span class=\"token punctuation\">.</span>price<span class=\"token punctuation\">,</span> book<span class=\"token punctuation\">.</span>genre<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n          <span class=\"token builtin\">App</span><span class=\"token punctuation\">.</span>pool<span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> connection<span class=\"token punctuation\">,</span> error <span class=\"token keyword\">in</span>\n              <span class=\"token keyword\">guard</span> <span class=\"token keyword\">let</span> connection <span class=\"token operator\">=</span> connection <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                  <span class=\"token builtin\">Log</span><span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error connecting: <span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>error<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>localizedDescription <span class=\"token operator\">?</span><span class=\"token operator\">?</span> <span class=\"token string\">\"Unknown Error\"</span><span class=\"token delimiter variable\">)</span></span>\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token keyword\">let</span> <span class=\"token number\">_</span> <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>internalServerError<span class=\"token punctuation\">)</span>\n                  <span class=\"token keyword\">return</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n              <span class=\"token punctuation\">}</span>\n              <span class=\"token keyword\">let</span> insertQuery <span class=\"token operator\">=</span> <span class=\"token function\">Insert</span><span class=\"token punctuation\">(</span>into<span class=\"token punctuation\">:</span> <span class=\"token builtin\">App</span><span class=\"token punctuation\">.</span>bookTable<span class=\"token punctuation\">,</span> rows<span class=\"token punctuation\">:</span> rows<span class=\"token punctuation\">)</span>\n              connection<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">:</span> insertQuery<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> insertResult <span class=\"token keyword\">in</span>\n                  <span class=\"token keyword\">guard</span> insertResult<span class=\"token punctuation\">.</span>success <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                      <span class=\"token builtin\">Log</span><span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error executing query: <span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>insertResult<span class=\"token punctuation\">.</span>asError<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>localizedDescription <span class=\"token operator\">?</span><span class=\"token operator\">?</span> <span class=\"token string\">\"Unknown Error\"</span><span class=\"token delimiter variable\">)</span></span>\"</span><span class=\"token punctuation\">)</span>\n                      <span class=\"token keyword\">let</span> <span class=\"token number\">_</span> <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>internalServerError<span class=\"token punctuation\">)</span>\n                      <span class=\"token keyword\">return</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">}</span>\n                  response<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>book<span class=\"token punctuation\">)</span>\n                  <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n              <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n\n      app<span class=\"token punctuation\">.</span>router<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/kuery\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">,</span> next <span class=\"token keyword\">in</span>\n          <span class=\"token builtin\">App</span><span class=\"token punctuation\">.</span>pool<span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> connection<span class=\"token punctuation\">,</span> error <span class=\"token keyword\">in</span>\n              <span class=\"token keyword\">guard</span> <span class=\"token keyword\">let</span> connection <span class=\"token operator\">=</span> connection <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                  <span class=\"token builtin\">Log</span><span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error connecting: <span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>error<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>localizedDescription <span class=\"token operator\">?</span><span class=\"token operator\">?</span> <span class=\"token string\">\"Unknown Error\"</span><span class=\"token delimiter variable\">)</span></span>\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token keyword\">let</span> <span class=\"token number\">_</span> <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>internalServerError<span class=\"token punctuation\">)</span>\n                  <span class=\"token keyword\">return</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n              <span class=\"token punctuation\">}</span>\n              <span class=\"token keyword\">let</span> selectQuery <span class=\"token operator\">=</span> <span class=\"token function\">Select</span><span class=\"token punctuation\">(</span>from<span class=\"token punctuation\">:</span> <span class=\"token builtin\">App</span><span class=\"token punctuation\">.</span>bookTable<span class=\"token punctuation\">)</span>\n              connection<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">:</span> selectQuery<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> selectResult <span class=\"token keyword\">in</span>\n                  <span class=\"token keyword\">guard</span> <span class=\"token keyword\">let</span> resultSet <span class=\"token operator\">=</span> selectResult<span class=\"token punctuation\">.</span>asResultSet <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                      <span class=\"token builtin\">Log</span><span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error connecting: <span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>selectResult<span class=\"token punctuation\">.</span>asError<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>localizedDescription <span class=\"token operator\">?</span><span class=\"token operator\">?</span> <span class=\"token string\">\"Unknown Error\"</span><span class=\"token delimiter variable\">)</span></span>\"</span><span class=\"token punctuation\">)</span>\n                      <span class=\"token keyword\">let</span> <span class=\"token number\">_</span> <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>internalServerError<span class=\"token punctuation\">)</span>\n                      <span class=\"token keyword\">return</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">}</span>\n                  <span class=\"token keyword\">var</span> books <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">Book</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                  resultSet<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> row<span class=\"token punctuation\">,</span> error <span class=\"token keyword\">in</span>\n                      <span class=\"token keyword\">guard</span> <span class=\"token keyword\">let</span> row <span class=\"token operator\">=</span> row <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                          <span class=\"token keyword\">if</span> <span class=\"token keyword\">let</span> error <span class=\"token operator\">=</span> error <span class=\"token punctuation\">{</span>\n                              <span class=\"token builtin\">Log</span><span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error getting row: <span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>error<span class=\"token delimiter variable\">)</span></span>\"</span><span class=\"token punctuation\">)</span>\n                              <span class=\"token keyword\">let</span> <span class=\"token number\">_</span> <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>internalServerError<span class=\"token punctuation\">)</span>\n                              <span class=\"token keyword\">return</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                          <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                              <span class=\"token comment\">// All rows have been processed</span>\n                              response<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>books<span class=\"token punctuation\">)</span>\n                              <span class=\"token keyword\">return</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                          <span class=\"token punctuation\">}</span>\n                      <span class=\"token punctuation\">}</span>\n                      <span class=\"token keyword\">guard</span> <span class=\"token keyword\">let</span> idString <span class=\"token operator\">=</span> row<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span><span class=\"token operator\">?</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">,</span>\n                          <span class=\"token keyword\">let</span> id <span class=\"token operator\">=</span> <span class=\"token function\">Int</span><span class=\"token punctuation\">(</span>idString<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                          <span class=\"token keyword\">let</span> title <span class=\"token operator\">=</span> row<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span><span class=\"token operator\">?</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">,</span>\n                          <span class=\"token keyword\">let</span> price <span class=\"token operator\">=</span> row<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span><span class=\"token operator\">?</span> <span class=\"token builtin\">Double</span><span class=\"token punctuation\">,</span>\n                          <span class=\"token keyword\">let</span> genre <span class=\"token operator\">=</span> row<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span><span class=\"token operator\">?</span> <span class=\"token builtin\">String</span>\n                          <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                              <span class=\"token builtin\">Log</span><span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Unable to decode book\"</span><span class=\"token punctuation\">)</span>\n                              <span class=\"token keyword\">let</span> <span class=\"token number\">_</span> <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>internalServerError<span class=\"token punctuation\">)</span>\n                              <span class=\"token keyword\">return</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                      <span class=\"token punctuation\">}</span>\n                      books<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token function\">Book</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">:</span> id<span class=\"token punctuation\">,</span> title<span class=\"token punctuation\">:</span> title<span class=\"token punctuation\">,</span> price<span class=\"token punctuation\">:</span> price<span class=\"token punctuation\">,</span> genre<span class=\"token punctuation\">:</span> genre<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">}</span>\n              <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">extension</span> <span class=\"token builtin\">App</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">static</span> <span class=\"token keyword\">let</span> poolOptions <span class=\"token operator\">=</span> <span class=\"token function\">ConnectionPoolOptions</span><span class=\"token punctuation\">(</span>initialCapacity<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> maxCapacity<span class=\"token punctuation\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\n      <span class=\"token comment\">// The createPool() will be different if you used a plugin other than PostgreSQL</span>\n      <span class=\"token keyword\">static</span> <span class=\"token keyword\">let</span> pool <span class=\"token operator\">=</span> <span class=\"token builtin\">PostgreSQLConnection</span><span class=\"token punctuation\">.</span><span class=\"token function\">createPool</span><span class=\"token punctuation\">(</span>host<span class=\"token punctuation\">:</span> <span class=\"token string\">\"localhost\"</span><span class=\"token punctuation\">,</span> port<span class=\"token punctuation\">:</span> <span class=\"token number\">5432</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">.</span><span class=\"token function\">databaseName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bookstoredb\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> poolOptions<span class=\"token punctuation\">:</span> poolOptions<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">static</span> <span class=\"token keyword\">let</span> bookTable <span class=\"token operator\">=</span> <span class=\"token function\">BookTable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>","frontmatter":{"path":"/docs/databases/kuery8","title":"Raw snippet 8"}},"docsList":{"nodes":[{"title":"Getting Started","items":[{"title":"Installation","link":"/docs/getting-started/installation"},{"title":"Hello World","link":"/docs/getting-started/hello-world"},{"title":"Create a Server using Kitura CLI","link":"/docs/getting-started/create-server-cli"},{"title":"Create a Server using SPM","link":"/docs/getting-started/create-server-spm"}]},{"title":"Logging","items":[{"title":"What is Logging?","link":"/docs/logging/what-is-logging"},{"title":"HeliumLogger","link":"/docs/logging/helium-logger"}]},{"title":"Routing","items":[{"title":"What is Routing?","link":"/docs/routing/what-is-routing"},{"title":"Codable Routing","link":"/docs/routing/codable-routing"},{"title":"OpenAPI","link":"/docs/routing/kitura-openapi"},{"title":"Raw Routing","link":"/docs/routing/raw-routing"}]},{"title":"Databases","items":[{"title":"What are Databases?","link":"/docs/databases/what-are-databases"},{"title":"SQL - ORM","link":"/docs/databases/orm"},{"title":"SQL - Kuery","link":"/docs/databases/kuery"},{"title":"NoSQL - CouchDB","link":"/docs/databases/couchdb"}]},{"title":"Sessions","items":[{"title":"What are Sessions?","link":"/docs/sessions/what-are-sessions"},{"title":"Codable Routing Session","link":"/docs/sessions/codable-session"},{"title":"Raw Routing Session","link":"/docs/sessions/raw-session"}]},{"title":"Authentication","items":[{"title":"What is Authentication?","link":"/docs/authentication/what-is-authentication"},{"title":"Basic Authentication","link":"/docs/authentication/basic-authentication"},{"title":"JSON Web Tokens","link":"/docs/authentication/jwt"},{"title":"OAuth 2.0 with Google/Facebook","link":"/docs/authentication/oauth2"}]},{"title":"Web Applications","items":[{"title":"What is Templating?","link":"/docs/web/what-is-templating"},{"title":"Static File Server","link":"/docs/web/static-file-server"},{"title":"Stencil","link":"/docs/web/stencil"},{"title":"Markdown","link":"/docs/web/markdown"}]},{"title":"Client","items":[{"title":"What is a client?","link":"/docs/client/client"},{"title":"iOS Client","link":"/docs/client/iOSClient"}]},{"title":"WebSockets","items":[{"title":"What are WebSockets?","link":"/docs/websockets/websockets"},{"title":"Echo Server","link":"/docs/websockets/echo-server"}]},{"title":"Deploying","items":[{"title":"Monitoring","link":"/docs/deploying/monitoring"},{"title":"Enabling SSL/TLS","link":"/docs/deploying/enabling-ssl"},{"title":"Docker","link":"/docs/deploying/docker"},{"title":"Kubernetes","link":"/docs/deploying/kubernetes"},{"title":"Cloud Foundry","link":"/docs/deploying/cloud-foundry"}]},{"title":"Configuring","items":[{"title":"Enabling SwiftNIO","link":"/docs/configuring/swiftnio"}]},{"title":"API","items":[{"title":"Kitura","link":"/docs/api/kitura"},{"title":"HTTP Client","link":"/docs/api/http-client"},{"title":"Sessions","link":"/docs/api/sessions"},{"title":"Authentication","link":"/docs/api/authentication"},{"title":"Web Templating","link":"/docs/api/web-templating"},{"title":"SQL Databases","link":"/docs/api/sql-databases"},{"title":"Non-SQL Databases","link":"/docs/api/non-sql-databases"},{"title":"Cloud Integration","link":"/docs/api/cloud-integration"},{"title":"Middlewares","link":"/docs/api/middlewares"},{"title":"Cryptography","link":null},{"title":"Email","link":"/docs/api/email"}]}]}},"pageContext":{"isCreatedByStatefulCreatePages":false}}}